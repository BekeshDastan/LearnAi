<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EduPlan AI â€” Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 min-h-screen antialiased">

  <div class="flex h-screen">

    <!-- Sidebar -->
    <aside class="hidden md:flex md:flex-col w-72 bg-white border-r border-gray-200">
      <div class="p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-indigo-600 flex items-center justify-center text-white font-bold text-xl">
            E
          </div>
          <span class="text-xl font-bold text-gray-900">EduPlan AI</span>
        </div>
      </div>

      <nav class="flex-1 px-3 py-6 space-y-1">
        <a href="my-courses.html" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
          <span class="text-xl mr-3">ðŸ“š</span>
          My Courses
        </a>
        <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
          <span class="text-xl mr-3">ðŸ“…</span>
          Calendar
        </a>
        <a href="#" class="flex items-center px-4 py-3 bg-indigo-50 text-indigo-700 font-medium rounded-lg">
          <span class="text-xl mr-3">ðŸ‘¤</span>
          Profile
        </a>
        <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
          <span class="text-xl mr-3">ðŸ“Š</span>
          Statistics
        </a>
      </nav>
    </aside>

    <!-- Main content -->
    <div class="flex-1 flex flex-col overflow-hidden">

      <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <h1 class="text-xl font-semibold text-gray-900">Profile</h1>
        <div class="flex items-center gap-4">
          <div class="text-right">
            <p class="font-medium"></p>
            <p class="text-sm text-gray-500"></p>
          </div>
          <div class="w-10 h-10 rounded-full bg-indigo-100 overflow-hidden border-2 border-indigo-200">
            <img src=""
              alt="Profile" class="w-full h-full object-cover" />
          </div>
        </div>
      </header>

      <!-- Profile content -->
      <main class="flex-1 overflow-y-auto p-6 lg:p-10">
        <div class="max-w-3xl mx-auto">

          <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">

            <!-- Gradient header -->
            <div class="bg-gradient-to-r from-indigo-600 to-indigo-800 px-8 py-12 text-white">
              <div class="flex flex-col sm:flex-row items-center gap-8">
                <div
                  class="w-32 h-32 rounded-full bg-white/20 backdrop-blur-sm border-4 border-white/40 overflow-hidden">
                  <img src="" alt="Profile picture" class="w-full h-full object-cover" />
                </div>
                <div>
                  <span id="headerName" class="font-medium">Bekesh Dastan</span>
                  <span id="headerEmail" class="text-sm text-gray-500">dastan@example.com</span>
                  <div class="mt-5 flex flex-wrap gap-8 text-indigo-100/90">
                    <div>
                      <span class="block text-xs uppercase tracking-wide opacity-80">Age</span>
                      <span class="text-2xl font-semibold" id="showAge">19</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Details / Edit section -->
            <div class="p-8 lg:p-10">

              <!-- VIEW MODE -->
              <div id="viewMode">
                <div class="flex justify-between items-center mb-8">
                  <h3 class="text-xl font-bold text-gray-900">Personal Information</h3>
                  <button onclick="toggleEditMode()"
                    class="px-5 py-2.5 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors">
                    Edit Profile
                  </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                  <div>
                    <p class="text-sm text-gray-500 mb-1">Name</p>
                    <p class="text-lg font-medium text-gray-900" id="viewName">Dastan</p>
                  </div>

                  <div>
                    <p class="text-sm text-gray-500 mb-1">Surname</p>
                    <p class="text-lg font-medium text-gray-900" id="viewSurname">Bekesh</p>
                  </div>

                  <div>
                    <p class="text-sm text-gray-500 mb-1">Age</p>
                    <p class="text-lg font-medium text-gray-900" id="viewAge">18</p>
                  </div>

                  <div>
                    <p class="text-sm text-gray-500 mb-1">Email</p>
                    <p class="text-lg font-medium text-gray-900 break-all" id="viewEmail">dastan@example.com</p>
                  </div>
                </div>

                <div class="pt-8 border-t border-gray-200">
                  <h3 class="text-xl font-bold text-gray-900 mb-6">Security</h3>
                  <div class="space-y-6">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-sm text-gray-500 mb-1">Password</p>
                        <p id="passwordDisplay" class="text-lg font-medium text-gray-900 tracking-widest">
                          â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢
                        </p>
                      </div>
                      <button
                        onclick="document.getElementById('passwordDisplay').textContent = 'MySecurePass123'; this.style.display='none'"
                        class="text-sm text-indigo-600 hover:text-indigo-800 font-medium transition-colors"
                        id="showPassword">
                        Show
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- EDIT MODE -->
              <form id="editMode" class="hidden space-y-10">

                <div class="flex justify-between items-center">
                  <h3 class="text-xl font-bold text-gray-900">Edit Profile</h3>
                  <div class="space-x-3">
                    <button type="button" onclick="toggleEditMode()"
                      class="px-5 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors">
                      Cancel
                    </button>
                    <button type="submit"
                      class="px-5 py-2.5 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors">
                      Save Changes
                    </button>
                  </div>
                </div>

                <!-- Personal Information -->
                <div>
                  <h4 class="text-lg font-semibold text-gray-800 mb-4">Personal Information</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                      <input type="text" value="Dastan" id="editName"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">Surname</label>
                      <input type="text" value="Bekesh" id="editSurname"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                      <input type="number" value="19" min="13" id="editAge"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                      <input type="email" value="dastan@example.com" id="editEmail"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
                    </div>
                  </div>
                </div>

                <!-- Password Change -->
                <div class="pt-8 border-t border-gray-200">
                  <h4 class="text-lg font-semibold text-gray-800 mb-4">Change Password</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
                      <input type="password" id="currentPasswordInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        required />
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                      <input type="password" id="newPasswordInput" placeholder="New password"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        required />
                    </div>

                    <div class="md:col-span-2">
                      <label class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
                      <input type="password" id="confirmPasswordInput" placeholder="Confirm new password"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        required />
                    </div>
                  </div>

                </div>

              </form>

            </div>
          </div>

        </div>
      </main>
    </div>
  </div>

  <script>
    const userId = localStorage.getItem('userId');

    // 1. Load data when the page opens
    async function loadUserProfile() {
      if (!userId || userId === "undefined") {
        alert("Please log in first");
        window.location.href = "LoggingIn.html";
        return;
      }

      try {
        const response = await fetch(`http://localhost:3000/auth/users/${userId}`);
        const user = await response.json();

        if (response.ok) {
          // Update View Mode UI
          document.getElementById('headerName').textContent = `${user.surname} ${user.name}`;
          document.getElementById('headerEmail').textContent = user.email;
          document.getElementById('viewName').textContent = user.name;
          document.getElementById('viewSurname').textContent = user.surname;
          document.getElementById('viewAge').textContent = user.age;
          document.getElementById('viewEmail').textContent = user.email;
          document.getElementById('showAge').textContent = user.age;

          const showBtn = document.getElementById('showPassword');
          const passDisplay = document.getElementById('passwordDisplay');

          showBtn.onclick = function () {
            passDisplay.textContent = user.password;
            showBtn.style.display = 'none';
          };

          // Pre-fill Edit Mode Form
          document.getElementById('editName').value = user.name;
          document.getElementById('editSurname').value = user.surname;
          document.getElementById('editAge').value = user.age;
          document.getElementById('editEmail').value = user.email;
        }
      } catch (err) {
        console.error("Error loading profile:", err);
      }
    }

    // 2. Handle Form Submission (Save Changes)
    document.getElementById('editMode').addEventListener('submit', async (e) => {
      e.preventDefault();

      const currentPassword = document.querySelector('input[placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"]').value;
      const newPassword = document.querySelector('input[placeholder="New password"]').value;
      const confirmPassword = document.querySelector('input[placeholder="Confirm new password"]').value;

      if (newPassword !== confirmPassword) {
        alert("New passwords do not match!");
        return;
      }

      const updatedData = {
        name: document.getElementById('editName').value,
        surname: document.getElementById('editSurname').value,
        age: document.getElementById('editAge').value,
        email: document.getElementById('editEmail').value,
        password: newPassword
      };

      try {
        const response = await fetch(`http://localhost:3000/auth/users/${userId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updatedData)
        });

        const result = await response.json();

        if (response.ok) {
          alert("Profile updated successfully!");
          toggleEditMode();
          loadUserProfile();
        } else {
          alert("Update failed: " + (result.error || "Unknown error"));
        }
      } catch (err) {
        console.error("Error updating profile:", err);
        alert("Server connection error.");
      }
    });

    window.onload = loadUserProfile;

    function toggleEditMode() {
      document.getElementById('viewMode').classList.toggle('hidden');
      document.getElementById('editMode').classList.toggle('hidden');
    }
  </script>

</body>

</html>