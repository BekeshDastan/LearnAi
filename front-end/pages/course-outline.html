<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Review Course Outline â€“ EduPlan AI</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { primary: '#4f46e5' } } }
    }
  </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 min-h-screen text-gray-900 dark:text-gray-100 antialiased">

<div class="min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-3xl bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700">

    <div class="bg-indigo-600 px-6 py-8 text-white">
      <h1 class="text-3xl font-bold">Review Your Learning Path</h1>
      <p class="mt-2 text-indigo-100">
        AI generated this outline. Confirm to generate full course content.
      </p>
    </div>

    <div class="p-8">
      <div class="mb-8">
        <label class="block text-sm font-semibold text-gray-500 uppercase mb-2">Course Title</label>
        <h2 id="courseTitle" class="text-2xl font-bold">Loadingâ€¦</h2>
      </div>

      <div class="mb-10">
        <label class="block text-sm font-semibold text-gray-500 uppercase mb-3">Chapters</label>
        <ul id="chaptersList" class="space-y-3"></ul>
      </div>

      <div class="flex gap-4 pt-6 border-t">
        <button
          onclick="goBack()"
          class="flex-1 px-6 py-3 border rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700">
          â† Back
        </button>

        <button
          id="confirmBtn"
          onclick="confirmPlan()"
          class="flex-1 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl disabled:opacity-50">
          Generate Course ğŸš€
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const API_BASE = 'http://localhost:3000';

  const pendingRaw = localStorage.getItem('pendingCourse');
  if (!pendingRaw) {
    alert('Course data not found. Please create a course again.');
    window.location.href = 'my-courses.html';
  }

  let pending;
  try {
    pending = JSON.parse(pendingRaw);
  } catch {
    alert('Invalid course data. Please create a course again.');
    window.location.href = 'my-courses.html';
  }

  if (
    !pending.courseId ||
    !pending.title ||
    !Array.isArray(pending.outline) ||
    pending.outline.length === 0
  ) {
    alert('Course outline is missing. Please create the course again.');
    window.location.href = 'my-courses.html';
  }

  document.getElementById('courseTitle').textContent = pending.title;

  const list = document.getElementById('chaptersList');
  pending.outline.forEach((chapter, i) => {
    const li = document.createElement('li');
    li.className =
      'flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border';
    li.innerHTML = `
      <div class="w-10 h-10 flex items-center justify-center bg-indigo-100 text-indigo-700 rounded-full font-bold">
        ${i + 1}
      </div>
      <span class="text-lg font-medium">${chapter}</span>
    `;
    list.appendChild(li);
  });

  function goBack() {
    window.location.href = 'my-courses.html';
  }

  async function confirmPlan() {
    const btn = document.getElementById('confirmBtn');
    btn.disabled = true;
    btn.textContent = 'Generatingâ€¦';

    try {
      const res = await fetch(
        `${API_BASE}/api/courses/${pending.courseId}/confirm`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ confirmedPlan: pending.outline })
        }
      );

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.error || `HTTP ${res.status}`);
      }

      const data = await res.json();

      localStorage.removeItem('pendingCourse');
      localStorage.setItem('currentCourseId', pending.courseId);
      window.location.href = 'course-dashboard.html';

    } catch (e) {
      alert('Failed to generate course.\n' + e.message);
    } finally {
      btn.disabled = false;
      btn.textContent = 'Generate Course ğŸš€';
    }
  }
</script>

</body>
</html>
